name: Expo Example - Android E2E Tests

# on:
#   push:
#     branches: [ main ]
#     paths:
#       - 'examples/expo-example/**'
#       - 'packages/**'
#       - '.github/workflows/e2e-expo-example-android.yml'
#   pull_request:
#     branches: [ main ]
#     paths:
#       - 'examples/expo-example/**'
#       - 'packages/**'
#       - '.github/workflows/e2e-expo-example-android.yml'
#   workflow_dispatch:

jobs:
  android-e2e:
    name: Run Expo Example Android E2E Tests
    runs-on: ubuntu-latest
    timeout-minutes: 60
    permissions:
      contents: read
    concurrency:
      group: ${{ github.workflow }}-${{ github.ref }}
      cancel-in-progress: true
    steps:
      - name: 🏗 Checkout repository
        uses: actions/checkout@v4

      - name: 🌿 Setup Node
        uses: actions/setup-node@v4
        with:
          node-version-file: 'examples/expo-example/.nvmrc'
          cache: 'yarn'

      - name: ☕ Setup JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'zulu'

      - name: 📦 Install dependencies
        run: yarn install --immutable

      - name: 📦 Install EAS CLI
        run: npm install -g eas-cli

      - name: 📦 Install Maestro
        run: |
          MAESTRO_VERSION=1.38.1
          curl -fsSL "https://get.maestro.mobile.dev" | bash
          echo "$HOME/.maestro/bin" >> $GITHUB_PATH

      - name: 🛠️ Build Android app with EAS
        run: eas build --profile testing -p android --local
        working-directory: examples/expo-example

      - name: 🧪 Run Maestro tests on Android
        run: yarn run test:e2e:android
        working-directory: examples/expo-example